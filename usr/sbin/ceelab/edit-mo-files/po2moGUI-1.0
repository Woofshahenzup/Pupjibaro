#!/bin/bash
#mo2poGUI-Script by RSH (11-2011)
#v1.1
## nilsonmorales i18n, i10n spanish locales
export TEXTDOMAIN=gui-po2moGUI-1.0
export OUTPUT_CHARSET=UTF-8

#set some variables
ORDNER=NameDerDatei
moname=""

#repeat until OK (with given filename) or cancel
while true
do

#show GUI
export MAIN_DIALOG="<window title=\"po2mo-Builder-GUI-1.1\" icon-name=\"gtk-file\">

<vbox>
	<text use-markup=\"true\"> <label>\"$(gettext '<b>rebuild the .mo file</b>')\"</label></text>
	<text><label>$(gettext 'drag & drop the .po file here and click OK.')</label></text> 
	<hbox>
		<entry>
			<default>${ORDNER}</default>
			<variable>ORDNER</variable>
		</entry>
	</hbox>
	<text><label>$(gettext 'The .mo file will be created at the same directory')</label></text> 
	<text><label>$(gettext 'Note: existing .mo file will be deleted')</label></text> 
	<text><label>$(gettext 'The created .po file will NOT be deleted.')</label></text>

	<hbox>
		<button ok></button>
		<button cancel></button>
		<button help></button>
	</hbox>
</vbox>
</window>"

I=$IFS; IFS=""
for STATEMENTS in  $(gtkdialog3 --center --program=MAIN_DIALOG); do
	eval $STATEMENTS
done
IFS=$I

#clicked on help button
if [ "$EXIT" = "Help" ]; then
	LACK="NameDerDatei"
	ORDNER=NameDerDatei
	continue
fi

#clicked on OK button
#check filename
if [ "$EXIT" = "OK" ]; then
	LACK=""
	if [ "$ORDNER" = "" ]; then
		LACK="NameDerDatei"
		ORDNER=NameDerDatei
	fi

	if [ "$LACK" != "" ]; then
		Xdialog --title "po2mo-Builder-GUI-1.1"   --wrap --screen-center --center --no-buttons --msgbox "$(gettext 'Filename in Field: '$LACK' missing.')"   8 40 60 
		continue
	fi
	if [ "$ORDNER" = "NameDerDatei" ]; then
		LACK="NameDerDatei"
		Xdialog --title "po2mo-Builder-GUI-1.1"   --wrap --screen-center --center --no-buttons --msgbox "$(gettext 'Filename in Field: '$LACK' missing.')"   8 40 60 
		continue
	fi

fi

#msgfmt available? (devx loaded)
#if no devx is loaded, the GUI returns
if [ "$EXIT" = "OK" ]; then
	if [ "`which msgfmt`" = "" ]; then
		Xdialog --title "po2mo-Builder-GUI-1.1"   --wrap --screen-center --center --no-buttons --msgbox "$(gettext 'Please, load the devx,sfs to edit the .mo files.')"   8 40 60 
		continue #exit 1
	fi
fi

break
done

#clicked on OK button
if [ "$EXIT" = "OK" ]; then
	if [ "$ORDNER" != "" ]; then
		nlen="`echo ${#ORDNER}`" # liefert die Länge vom vollständigen .mo Namen
		moname=$ORDNER
		moname2="${moname:0:nlen-3}"
		exec msgfmt "$ORDNER" -o "$moname2" &
		sleep 1
		Xdialog --title "po2mo-Builder-GUI-1.1"   --wrap --screen-center --center --no-buttons --msgbox "$(gettext 'rebuilding .mo file: done')"   8 40 60 

	fi
fi

#mo2poGUI-Script by RSH (11-2011)

# End
